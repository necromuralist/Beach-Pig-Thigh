<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Jinja P5 Helper | Beach Pig Rump &amp; Thigh</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Beach-Pig-Thigh/templates/jinja/jinja-p5-helper/index.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../favicon-16x16.png">
<link rel="manifest" href="../../../site.webmanifest">
<meta name="author" content="The Cloistered Monkey">
<meta property="og:site_name" content="Beach Pig Rump &amp; Thigh">
<meta property="og:title" content="Jinja P5 Helper">
<meta property="og:url" content="https://necromuralist.github.io/Beach-Pig-Thigh/templates/jinja/jinja-p5-helper/index.html">
<meta property="og:description" content="The P5 Helper Template


This is where I defined some macros to add the p5 code to posts. It's based on the math_helper.tmpl template, although it took a little bit more work (well, too much work) to ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-05-02T16:14:09-07:00">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="jinja">
<meta property="article:tag" content="p5">
<meta property="article:tag" content="template">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../../">

            <span id="blog-title">Beach Pig Rump &amp; Thigh</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../posts/" class="nav-link">Posts</a>
                </li>
<li class="nav-item">
<a href="../../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../rss.xml" class="nav-link">RSS</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Monkey Pages</a>
            <div class="dropdown-menu">
                    <a href="https://necromuralist.github.io/" class="dropdown-item">The Cloistered Monkey</a>
                    <a href="https://necromuralist.github.io/Ape-Iron/" class="dropdown-item">Ape Iron</a>
                    <a href="https://necromuralist.github.io/Bowling-For-Data/" class="dropdown-item">Bowling For Data</a>
                    <a href="https://necromuralist.github.io/Give-The-Fish/" class="dropdown-item">Give the Fish</a>
                    <a href="https://necromuralist.github.io/Neurotic-Networking/" class="dropdown-item">Neurotic Networking</a>
                    <a href="https://necromuralist.github.io/Terribilis-Ludum/" class="dropdown-item">Terribilis Ludum</a>
                    <a href="https://necromuralist.github.io/Visions-Voices-Data/" class="dropdown-item">Visions, Voices, Data</a>
            </div>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" role="search" class="d-flex">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Beach-Pig-Thigh/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="form-control me-2" style="margin-top: 4px;" aria-lab><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.org" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Jinja P5 Helper</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="outline-container-org4fa1261" class="outline-2">
<h2 id="org4fa1261">The P5 Helper Template</h2>
<div class="outline-text-2" id="text-org4fa1261">
<p>
This is where I defined some macros to add the p5 code to posts. It's based on the <code>math_helper.tmpl</code> template, although it took a little bit more work (well, too much work) to figure out how to get the metadata for this template.
</p>

<div class="highlight"><pre><span></span><span class="c">{#  -*- coding: utf-8 -*- #}</span>

<span class="err">&lt;</span><span class="p">&lt;</span><span class="nt">p5-scripts-macro</span><span class="p">&gt;</span>&gt;

<span class="err">&lt;</span><span class="p">&lt;</span><span class="nt">p5-post-macro</span><span class="p">&gt;</span>&gt;

<span class="err">&lt;</span><span class="p">&lt;</span><span class="nt">p5-index-macro</span><span class="p">&gt;</span>&gt;
</pre></div>
</div>
</div>

<div id="outline-container-org9bcf3c2" class="outline-2">
<h2 id="org9bcf3c2">P5 Scripts</h2>
<div class="outline-text-2" id="text-org9bcf3c2">
<p>
This is the macro to call to add the tag to pull in the p5 code from a CDN.
</p>

<div class="highlight"><pre><span></span>{# macro to add the p5.js code tag #}
{% macro p5_scripts() %}
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
{% endmacro %}
</pre></div>
</div>
</div>

<div id="outline-container-org3bea09a" class="outline-2">
<h2 id="org3bea09a">P5 Post Macro</h2>
<div class="outline-text-2" id="text-org3bea09a">
<p>
This is a macro to use if you have a template with a single post object (e.g. if you override the <code>post.tmpl</code> template or one of its children). I'm using a dedicated template for p5 posts right now so it isn't being used.
</p>

<div class="highlight"><pre><span></span><span class="c">{# macro for a single post #}</span>
<span class="c">{# `post`: a Post object #}</span>
<span class="cp">{%</span> <span class="k">macro</span> <span class="nv">p5_scripts_ifpost</span><span class="o">(</span><span class="nv">post</span><span class="o">)</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">post.meta</span><span class="o">(</span><span class="s2">"has_p5"</span><span class="o">)</span> <span class="cp">%}</span>
	<span class="cp">{{</span> <span class="nv">p5_scripts</span><span class="o">()</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgbe2352e" class="outline-2">
<h2 id="orgbe2352e">P5 Post Index Macro</h2>
<div class="outline-text-2" id="text-orgbe2352e">
<p>
This is the macro I'm adding to the <code>index.tmpl</code> template to get p5 into the latest pages feed. Jinja doesn't support the comprehension-type syntax that <code>mako</code> does and <code>Nikola</code> puts the metadata dictionary into a Functionary object which is a default dict that is callable. The metadata dictionary that we want is actually set as the value to a key in the dictionary matching the language for the sight (<code>en</code> in my case). So you can't access it directly (e.g. you can't use <code>post.meta.has_p5</code>) but if you call the meta object like a function instead of using it as a dictionary it will bypass the language key for you so you don't have to know what the language is (e.g. <code>post.meta("has_p5")</code> is the same as <code>post.meta.en.has_p5</code> (if English is the language being used)). Since I only use English it's probably unnecessary to use the function-syntax, but it seems to be the way it's intended to be used (and it took forever to figure out what was going on) so I'm using it.
</p>

<p>
But, after I set it up to check for <code>has_p5</code> in the metadata I realized that this fixed the <code>index.tmpl</code> but I'd have to update the <code>post.tmpl</code> to use it for individual posts, which seemed like too much so I instead set it to also check if the post uses the <code>p5.tmpl</code> template. If I start adding more conditional imports maybe it'll make sense to use <code>has_p5</code> but for now, the only way that works both in the feed and when viewing an individual post is to set the <code>.. template: p5.tmpl</code> metadata at the top of a post.
</p>

<div class="highlight"><pre><span></span><span class="c">{# macro used by feed page with multiple posts (e.g. index.tmpl) #}</span>
<span class="c">{# 'posts': list of Post objects #}</span>
<span class="c">{# jinja doesn't support comprehensions so we have to use a for-loop #}</span>
<span class="c">{# the ~post.meta~ object is a Functionary object #}</span>
<span class="c">{# the metadata is in a dictionary that's in a dictionary #}</span>
<span class="c">{# if you try ~post.meta.has_p5~ it will fail because you need the language you're using as a key #}</span>
<span class="c">{# e.g. ~post.meta.en.has_p5~ #}</span>
<span class="c">{# to not refer to the langugage you need to call it like a function, passing in the "has_p5" key as an argument #}</span>
<span class="cp">{%</span> <span class="k">macro</span> <span class="nv">p5_scripts_ifposts</span><span class="o">(</span><span class="nv">posts</span><span class="o">)</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">set</span> <span class="nv">p5_added</span> <span class="o">=</span> <span class="kp">False</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">posts</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="o">(</span><span class="nv">post.meta</span><span class="o">(</span><span class="s2">"has_p5"</span><span class="o">)</span> <span class="k">or</span> <span class="nv">post.meta</span><span class="o">(</span><span class="s2">"template"</span><span class="o">)</span> <span class="o">==</span> <span class="s2">"p5.tmpl"</span><span class="o">)</span> <span class="k">and</span> <span class="k">not</span> <span class="nv">p5_added</span> <span class="cp">%}</span>
      <span class="cp">{%</span> <span class="k">set</span> <span class="nv">p5_added</span> <span class="o">=</span> <span class="kp">True</span> <span class="cp">%}</span>
      <span class="cp">{{</span> <span class="nv">p5_scripts</span><span class="o">()</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
    </div>
    
            
</article><!--End of body content--><footer id="footer">
            Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<div id="license" xmlns:cc="http://creativecommons.org/ns#">This work is licensed under
<a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY 4.0
<img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a>
</div>

            
            
        </footer>
</div>
</div>


        <script src="../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
