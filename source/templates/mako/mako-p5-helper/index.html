<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="A mako template of p5 helpers.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mako P5 Helper | Beach Pig Thigh Tower</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Beach-Pig-Thigh/source/templates/mako/mako-p5-helper/">
<!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><link rel="apple-touch-icon" sizes="180x180" href="../../../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../../favicon-16x16.png">
<link rel="manifest" href="../../../../site.webmanifest">
<meta name="author" content="The Cloistered Monkey">
<meta property="og:site_name" content="Beach Pig Thigh Tower">
<meta property="og:title" content="Mako P5 Helper">
<meta property="og:url" content="https://necromuralist.github.io/Beach-Pig-Thigh/source/templates/mako/mako-p5-helper/">
<meta property="og:description" content="A mako template of p5 helpers.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-05-02T16:14:09-07:00">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="mako">
<meta property="article:tag" content="p5">
<meta property="article:tag" content="template">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../../../">

            <span id="blog-title">Beach Pig Thigh Tower</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../" class="nav-link">Source Code</a>
                </li>
<li class="nav-item">
<a href="../../../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Beach-Pig-Thigh/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.org" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Mako P5 Helper</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="outline-container-org6d65758" class="outline-2">
<h2 id="org6d65758">The P5 Helper Template</h2>
<div class="outline-text-2" id="text-org6d65758">
<p>
This is where I defined some macros to add the p5 code to posts. It's based on the <code>math_helper.tmpl</code> template, although it took a little bit more work (well, too much work) to figure out how to get the metadata for this template.
</p>

<div class="highlight"><pre><span></span>## -*- coding: utf-8 -*-

&lt;&lt;p5-scripts-macro&gt;&gt;

&lt;&lt;p5-post-macro&gt;&gt;

&lt;&lt;p5-index-macro&gt;&gt;
</pre></div>
</div>
</div>

<div id="outline-container-org9f81698" class="outline-2">
<h2 id="org9f81698">P5 Scripts</h2>
<div class="outline-text-2" id="text-org9f81698">
<p>
This is the macro to call to add the tag to pull in the p5 code from a CDN. Any key you put in the <code>GLOBAL_CONTEXT</code> dictionary in your <code>conf.py</code> file becomes a variable you can use in the template. So in this case, to set a different source for the p5 library the user could update the <code>GLOBAL_CONTEXT</code> to be:
</p>

<div class="highlight"><pre><span></span><span class="n">GLOBAL_CONTEXT</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"p5_library_source"</span><span class="p">:</span>
		  <span class="p">(</span><span class="s1">'&lt;script'</span> <span class="s1">'src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"'</span>
		   <span class="s1">'integrity="sha512-3RlxD1bW34eFKPwj9gUXEWtdSMC59QqIqHnD8O/NoTwSJhgxRizdcFVQhUMFyTp5RwLTDL0Lbcqtl8b7bFAzog=="'</span>
		   <span class="s1">' crossorigin="anonymous"'</span>
		   <span class="s1">' referrerpolicy="no-referrer"&gt;&lt;/script&gt;'</span><span class="p">)}</span>
</pre></div>

<p>
And in the template there will magically appear a variable named <code>p5_library_source</code> with our new <code>script</code> tag in it.
</p>

<div class="highlight"><pre><span></span>&lt;%doc&gt;
Macro to add the p5 library to a page.

To override the default source put the new source in ~GLOBAL_CONTEXT["p5_library_source"]~
in the ~conf.py file. This will override the entire script tag so you can also set a file
location if you choose not to use the CDN
&lt;/%doc&gt;
&lt;%def name="p5_scripts()"&gt;
% if p5_library_source:
  ${p5_library_source}
% else:
  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"
	  integrity="sha512-3RlxD1bW34eFKPwj9gUXEWtdSMC59QqIqHnD8O/NoTwSJhgxRizdcFVQhUMFyTp5RwLTDL0Lbcqtl8b7bFAzog=="
	  crossorigin="anonymous" referrerpolicy="no-referrer"&gt;&lt;/script&gt;
% endif
&lt;/%def&gt;
</pre></div>
</div>
</div>

<div id="outline-container-org458111a" class="outline-2">
<h2 id="org458111a">P5 Post Macro</h2>
<div class="outline-text-2" id="text-org458111a">
<p>
This is a macro to use if you have a template with a single post object (e.g. if you override the <code>post.tmpl</code> template or one of its children). I'm using a dedicated template for p5 posts right now so it isn't being used.
</p>

<div class="highlight"><pre><span></span>&lt;%doc&gt;
 macro for a single post
 `post`: a Post object
&lt;/%doc&gt;
&lt;%def name="p5_ifpost(post)"&gt;
    %if post.meta("has_p5"):
	${p5_scripts()}
    %endif
&lt;/%def&gt;
</pre></div>
</div>
</div>

<div id="outline-container-org38ba122" class="outline-2">
<h2 id="org38ba122">P5 Post Index Macro</h2>
<div class="outline-text-2" id="text-org38ba122">
<p>
This is the macro I'm adding to the <code>index.tmpl</code> template to get p5 into the latest pages feed. Jinja doesn't support the comprehension-type syntax that <code>mako</code> does and <code>Nikola</code> puts the metadata dictionary into a Functionary object which is a default dict that is callable. The metadata dictionary that we want is actually set as the value to a key in the dictionary matching the language for the sight (<code>en</code> in my case). So you can't access it directly (e.g. you can't use <code>post.meta.has_p5</code>) but if you call the meta object like a function instead of using it as a dictionary it will bypass the language key for you so you don't have to know what the language is (e.g. <code>post.meta("has_p5")</code> is the same as <code>post.meta.en.has_p5</code> (if English is the language being used)). Since I only use English it's probably unnecessary to use the function-syntax, but it seems to be the way it's intended to be used (and it took forever to figure out what was going on) so I'm using it.
</p>

<p>
But, after I set it up to check for <code>has_p5</code> in the metadata I realized that this fixed the <code>index.tmpl</code> but I'd have to update the <code>post.tmpl</code> to use it for individual posts, which seemed like too much so I instead set it to also check if the post uses the <code>p5.tmpl</code> template. If I start adding more conditional imports maybe it'll make sense to use <code>has_p5</code> but for now, the only way that works both in the feed and when viewing an individual post is to set the <code>.. template: p5.tmpl</code> metadata at the top of a post.
</p>

<div class="highlight"><pre><span></span>&lt;%doc&gt;
  macro used by feed page with multiple posts (e.g. index.tmpl)
 'posts': list of Post objects
 the ~post.meta~ object is a Functionary object
 the metadata is in a dictionary that's in a dictionary
 if you try ~post.meta.has_p5~ it will fail because you need the language you're using as a key
   e.g. ~post.meta.en.has_p5~ 
 To not refer to the langugage you need to call it like a function, passing in the "has_p5" key as an argument
&lt;/%doc&gt;
&lt;%def name="p5_scripts_ifposts(posts)"&gt;
  %if any((post.meta("has_p5") or post.meta("template") == "p5.tmpl") for post in posts):
      ${p5_scripts()}
  %endif
&lt;/%def&gt;
</pre></div>
</div>
</div>
    </div>
    
            
</article><!--End of body content--><footer id="footer"><a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
 <img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
